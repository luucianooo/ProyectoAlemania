<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
        <!--<script src="servidor.js"></script>--> 
        <title>Pagina AR</title>
    </head>
    <body>
        
        <div class="contenidoAR">    
            <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: true">
                <a-nft
                type="nft"
                url=""
                smooth="true"
                smoothCount="10"
                smoothTolerance=".01"
                smoothThreshold="5"
                >
                    <a-text 
                    id="texto"
                    position="10 1 0"
                    scale="2 2 2"
                    >
                    </a-text>
                </a-nft>
            </a-scene>
        </div>
        <script>
            const socket = newWebSocket("ws://localhost:8765");

            socket.onopen = function(event){
                console.log("Conexion WebSpocket establecida");
            };
             
            socket.onmessage = function(event) {
                const datos = event.data;
                const img = new Image();
                img.src = 'data:image/jpeg;base64,' + datos;
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    const urlImg = canvas.toDataURL('image/jpeg');
                    const markerElement = document.querySelector('a-nft');
                    markerElement.setAttribute('url', urlImg);
                };
                const texto = document.getElementById("texto");
                if(datos = "cessna172"){
                    texto.setAttribute("value", "Se ha detectado un Cessna 172");
                }
                else{
                    text.setAttribute("value", "No se ha detectado el cessna 172");
                }
            };
            


        </script>
    </body>
</html>